@plugin '@tailwindcss/typography';

@layer base {
  /* ===== Override default Tailwind Typography styles ===== */
  .app-prose {
    @apply prose;

    h1,
    h2,
    h3,
    h4,
    th {
      @apply mb-3;
    }

    h3 {
      @apply italic;
    }

    p,
    strong,
    ol,
    ul,
    figcaption,
    table,
    code {
      @apply text-foreground;
    }

    a { @apply break-words decoration-dashed underline-offset-4 hover:text-accent focus-visible:no-underline; }

    ul {
      @apply overflow-x-clip;
    }

    li {
      @apply marker:text-accent;
    }

    hr {
      @apply border-border;
    }

    img {
      @apply mx-auto border border-border;
    }

    figcaption {
      @apply opacity-75;
    }

    table {
      th,
      td {
        @apply border border-border p-2;
      }

      th {
        @apply py-1.5;
      }

      code {
        @apply break-all sm:break-normal;
      }
    }

    code {
      @apply rounded bg-muted/75 p-1 break-words text-foreground before:content-none after:content-none;
    }

    .astro-code code {
      @apply flex-[1_0_100%] bg-inherit p-0;
    }

    blockquote {
      @apply border-s-accent/80 break-words opacity-80;
    }

    details {
      @apply inline-block cursor-pointer text-foreground select-none [&_p]:hidden [&_ul]:!my-0;
    }

    summary {
      @apply focus-visible:no-underline focus-visible:outline-2 focus-visible:outline-offset-1 focus-visible:outline-accent focus-visible:outline-dashed;
    }

    pre {
      @apply focus-visible:border-transparent focus-visible:outline-2 focus-visible:outline-accent focus-visible:outline-dashed;
    }
  }

  /* Unified heading colors by theme */
  .app-prose h1,
  .app-prose h2,
  .app-prose h3,
  .app-prose h4,
  .app-prose h5,
  .app-prose h6 { color: var(--heading); }

  /* Optional crisp stroke for readability on all themes */
  .app-prose h1 { -webkit-text-stroke: 0.35px color-mix(in srgb, var(--foreground) 30%, transparent); }
  .app-prose h2 { -webkit-text-stroke: 0.35px color-mix(in srgb, var(--foreground) 28%, transparent); }
  .app-prose h3 { -webkit-text-stroke: 0.3px color-mix(in srgb, var(--foreground) 24%, transparent); }
  .app-prose h4 { -webkit-text-stroke: 0.25px color-mix(in srgb, var(--foreground) 20%, transparent); }

  /* Post pages: subtle glow on all headings (dark mode only) */
  html[data-theme="dark"] #article.app-prose h1,
  html[data-theme="dark"] #article.app-prose h2,
  html[data-theme="dark"] #article.app-prose h3,
  html[data-theme="dark"] #article.app-prose h4,
  html[data-theme="dark"] #article.app-prose h5,
  html[data-theme="dark"] #article.app-prose h6 { text-shadow: var(--glow-def); }

  /* Light theme: remove heading glows entirely */
  html[data-theme="light"] .app-prose h1,
  html[data-theme="light"] .app-prose h2,
  html[data-theme="light"] .app-prose h3,
  html[data-theme="light"] .app-prose h4 { text-shadow: none; }
  /* Keep small headings readable */
  .app-prose h5,
  .app-prose h6 { color: var(--heading); }

  /* Distinct accents for common prose elements */
  .app-prose blockquote { border-inline-start-color: var(--neon-yellow); }
  .app-prose li::marker { color: var(--neon-magenta); }
  /* Slight accent for inline code only */
  .app-prose :not(pre) > code { box-shadow: 0 0 0 1px color-mix(in srgb, var(--accent) 30%, transparent), 0 0 10px color-mix(in srgb, var(--accent) 12%, transparent) inset; }
  /* Remove glow for code blocks */
  .app-prose pre code,
  .astro-code,
  .astro-code code { box-shadow: none !important; filter: none !important; }

  /* ===== Code Blocks & Syntax Highlighting ===== */
  .astro-code {
    @apply flex border bg-(--shiki-light-bg) text-(--shiki-light) outline-border [&_span]:text-(--shiki-light);
  }

  html[data-theme="dark"] .astro-code {
    @apply bg-(--shiki-dark-bg) text-(--shiki-dark) [&_span]:text-(--shiki-dark);
  }

  /* Styles for Shiki transformers */
  /* https://shiki.style/packages/transformers */
  .astro-code {
    .line.diff.add {
      @apply relative inline-block w-full bg-green-400/20 before:absolute before:-left-3 before:text-green-500 before:content-['+'];
    }
    .line.diff.remove {
      @apply relative inline-block w-full bg-red-500/20 before:absolute before:-left-3 before:text-red-500 before:content-['-'];
    }
    .line.highlighted {
      @apply inline-block w-full bg-slate-400/20;
    }
    .highlighted-word {
      @apply rounded-sm border border-border px-0.5 py-px;
    }
  }
}
